!function(){function a(){var a=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&"querySelector"in document&&"localStorage"in window&&"addEventListener"in window,b=!!(document.documentMode&&document.documentMode<=9),c=function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect};return b?!1:a&&c()}var b=function(){var a=this;this.linkId="<%= iframeUid %>",this.scaffoldLite="<%= scaffoldLite %>",this.initIstatsIfRequiredThen(function(){a.createIframe()}),this.updateSizeWhenWindowResizes()};if(b.prototype={updateSizeWhenWindowResizes:function(){var a=this;this.onEvent(window,"resize",function(){a.setDimensions()})},onEvent:function(a,b,c,d){void 0===d&&(d=!1),a.addEventListener?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)},data:{},updateFrequency:32,createIframe:function(){var a=this.linkId,b=document.getElementById(a),c=b.href,d=b.parentNode.className,e=this,f=this.getWindowLocationOrigin(),g=window.location.hash||"",h=encodeURIComponent(window.location.href.replace(g,"")),i=this.onBbcDomain();this.staticHeight=b.getAttribute("data-static-iframe-height"),this.addLoadingSpinner(b,a),this.hostIsNewsApp(d)&&(f=d),this.elm=document.createElement("iframe"),this.elm.className="responsive-iframe",this.elm.style.width="100%",this.elm.scrolling="no",this.elm.setAttribute("allowfullscreen",""),this.elm.frameBorder="0",this.decideHowToTalkToIframe(c),this.elm.src=c+"&hostid="+f.split("//")[1]+"&hostUrl="+h+"&iframeUID="+a+"&onbbcdomain="+i+g,b.parentNode.appendChild(this.elm),b.parentNode.removeChild(b),this.lastRecordedHeight=this.elm.height,this.handleIframeLoad(function(){e.getAnyInstructionsFromIframe(),e.setDimensions()}),this.removeFallbackImageFromHostPage()},addLoadingSpinner:function(a,b){var c=document.createElement("div");c.id=b+"--bbc-news-visual-journalism-loading-spinner",c.className="bbc-news-visual-journalism-loading-spinner",a.parentNode.appendChild(c)},handleIframeLoad:function(a){this.onEvent(window,"load",function(){a()},!0),this.elm.onload?this.elm.onload=a:"attachEvent"in this.elm&&this.elm.attachEvent("onload",a)},decideHowToTalkToIframe:function(a){if(window.postMessage){var b=this.getPath(a);this.uidForPostMessage=this.getPath(a),this.setupPostMessage(b)}else this.data.height=this.staticHeight,this.elm.scrolling="yes"},onBbcDomain:function(){return window.location.host.search("bbc.co")>-1},setupPostMessage:function(a){var b=this;this.onEvent(window,"message",function(a){b.postMessageCallback(a.data)})},postMessageCallback:function(a){this.postBackMessageForThisIframe(a)&&(this.processCommunicationFromIframe(this.getObjectNotationFromDataString(a)),this.processIStatsInstructions(this.data))},postBackMessageForThisIframe:function(a){return a&&a.split("::")[0]===this.uidForPostMessage},getObjectNotationFromDataString:function(a){return JSON.parse(a.split("::")[1])},processCommunicationFromIframe:function(a){this.data=a,this.setDimensions(),this.getAnyInstructionsFromIframe()},hostIsNewsApp:function(a){return a.indexOf("bbc_news_app")>-1},getIframeContentHeight:function(){return this.data.height&&(this.lastRecordedHeight=this.data.height),this.lastRecordedHeight},setDimensions:function(){this.elm.width=this.elm.parentNode.clientWidth,this.elm.height=this.getIframeContentHeight()},getAnyInstructionsFromIframe:function(){"removeLoadingSpinner"===this.data.msg&&this.removeLoadingSpinner()},removeLoadingSpinner:function(){var a=document.getElementById(this.linkId+"--bbc-news-visual-journalism-loading-spinner");a&&a.parentNode.removeChild(a)},getPath:function(a){var b=a.replace("http://","");return b.substring(b.indexOf("/")).split("?")[0]},getWindowLocationOrigin:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},removeAppWebViewLinksFromHostPage:function(){this.removeElementFromHostPage("a","href",window.location.pathname)},removeFallbackImageFromHostPage:function(){var a=this.getQueryStringValue("fallback");a&&this.removeElementFromHostPage("img","src",a)},getQueryStringValue:function(a){var b='<!--#echo var="QUERY_STRING" -->',c=new RegExp("(?:[\\?&]|&amp;)"+a+"=([^&#]*)"),d=c.exec(b);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},removeElementFromHostPage:function(a,b,c){var d;if("undefined"!=typeof document.querySelector)d=document.querySelector(a+"["+b+'*="'+c+'"]'),d&&d.parentNode.removeChild(d);else{d=document.getElementsByTagName(a);for(var e=0;e<d.length;++e)d[e][b].indexOf(c)>=0&&d[e].parentNode.removeChild(d[e])}},initIstatsIfRequiredThen:function(a){var b=this;"false"===this.scaffoldLite&&this.onBbcDomain()&&"require"in window?require(["istats-1"],function(c){b.istats=c,a()}):(b.istats={log:function(){}},"console"in window&&!("require"in window)&&window.console.log("BBC News Visual Journalism warning: require not defined"),a())},istatsQueue:[],processIStatsInstructions:function(a){this.istatsInTheData(a)&&(this.addToIstatsQueue(a),this.emptyQueue(this.istatsQueue))},istatsInTheData:function(a){return a.istats&&a.istats.actionType},addToIstatsQueue:function(a){this.istatsQueue.push({actionType:a.istats.actionType,actionName:a.istats.actionName,viewLabel:a.istats.viewLabel})},istatsQueueLocked:!1,emptyQueue:function(a){var b;if(this.istats&&a){this.istatsQueueLocked=!0;for(var c=0,d=a.length;d>c;c++)b=a.pop(),this.istats.log(b.actionType,b.actionName,{view:b.viewLabel});this.istatsQueueLocked=!1}}},a()){new b}}();